---
title: "assign1_kat_leigh_part2"
author: "Kat Leigh"
date: "1/20/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# load packages

remotes::install_github("coolbutuseless/ggpattern")
library(ggpattern)
library(tidyverse)
library(lubridate)
library(broom)
library(patchwork)
library(ggfortify)
library(readxl)
library(gghighlight)
library(plotly)
library(janitor)

```

This data set contains the difference between an observed (historical, from 1956 - 2020) or predicted (future, from 2010 - 2020) value for an aquatic parameter (i.e. temperature, salinity, dissolved oxygen, or pH) and an ideal value for that parameter. These ideal values were determined by averaging the values recommended by scientific literature for each life stage (i.e. egg, zoea, megalopae, juvenile, and adult) of Blue Swimming Crab (Portunus armatus, formerly Portunus pelagicus). The differences were normalized across all depths (surface, 30m, 100m, and bottom), time periods, and parameters. The question at hand is whether latitude/longitude and the normalized differences are correlated in some way to each other and/or to the parameters or life stages.

```{r}
# read in the data

normdiffs_depth_lifestage_time_param <- read.csv("C:/Users/kll86/OneDrive/EDF internship summer 2020/NC_files/mean_alldepths_allstage_allparam_histfut_norm_diffs.csv")

```

```{r}

# set the proper classes for the data to run a PCA

normdiffs <- normdiffs_depth_lifestage_time_param %>% 
  mutate(depth = as.numeric(depth),
         time = as.numeric(time),
         lifestage = as.numeric(lifestage),
         parameter = as.factor(parameter))

# only select the historical data and the life stage, parameter, normalized differences, and latitude / longitude pairs to run the analysis

normdiffs_hist <- normdiffs %>% 
  filter(time == 2) %>% 
  select(lifestage,parameter, lat, lon, norm_diff)

#remove the larger files to free up space

remove("normdiffs", "normdiffs_depth_lifestage_time_param")

# combine the latitude and longitude values into a single combination value that represents both numbers. Add 180 to these values before summing to get rid of negative values.

normdiffs_hist_combo <- normdiffs_hist %>% 
  mutate(latlon = ((lat+180)+(lon+180)))

#remove a large file to free up space

remove("normdiffs_hist")

# Conduct a PCA. First just select the numerical inputs to compare (latlon and norm_diff). Then, scale these values. Finally run a PCA.

normdiff_pca_hist_c <- normdiffs_hist_combo %>%
  dplyr::select(latlon, norm_diff) %>% 
  scale() %>%
  prcomp()

# plot the outputs of the PCA. categorize the data by parameter (shape of points) and by life stage (color). 

autoplot(normdiff_pca_hist_c,
         data = normdiffs_hist_combo,
         loadings = TRUE,
         colour = as.factor('lifestage'),
         shape = 'parameter',
         alpha = .2,
         loadings.label = TRUE,
         loadings.colour = "black",
         loadings.label.colour = "black",
         loadings.label.vjust = -0.5
         ) +  theme_minimal()

# Variance explained by each PC
screeplot(normdiff_pca_hist_c, type = "lines")

# See the loadings (weighting for each principal component)
normdiff_pca_hist_c$rotation
```

We find that there is little correlation between the normalized differences and the lat/lon. This makes sense as lat/lon is simply a random number assigned to a location on the globe and not related to the normalized differences calculated. It is interesting to note the clustering that occurs however based on categorization by parameter and by life stage. A more appropriate analysis would be to run multiple regressions since the normalized difference is the only dependent variable, and the predictor variables being tested are lat/lon, depth, parameter, and life stage.